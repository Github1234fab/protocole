<script>
	let formData = {
		age: '',
		profil: '',
		pathologie: '',
		therapiePrecedente: '',
		methodeHypnose: '',
		induction: true,
		duree: '',
		ton: '',
		objectif: ''
	};

	let generatedPrompt = '';
	let aiResponse = '';
	let loading = false;
	let error = '';
	const ages = Array.from({ length: 96 }, (_, i) => i + 4);
	let exempleResponse = `---

# ğŸŒ¿ Se libÃ©rer de la jalousie toxique : un voyage intÃ©rieur de guÃ©rison et de transformation

---

## I. Le miroir brisÃ©

Il Ã©tait une fois un Ãªtre qui regardait un miroirâ€¦ mais ce miroir Ã©tait fendu. Ã€ travers ses fissures, il voyait son reflet dÃ©formÃ©. Une image troublÃ©e, instable, morcelÃ©e. Et dans ce reflet, il avait du mal Ã  se reconnaÃ®tre. Le doute sâ€™infiltrait, lâ€™ombre sâ€™Ã©paississait. Et avec cette ombre, venait la jalousie. Cette jalousie toxique, insidieuse, qui glissait comme une brume froide entre les pensÃ©es.

Mais ce miroir brisÃ© nâ€™Ã©tait pas la vÃ©ritÃ©. Il nâ€™Ã©tait quâ€™un objet, ancien, fatiguÃ©, colorÃ© par les blessures du passÃ©. Ce nâ€™Ã©tait pas lâ€™Ã¢me. Ce nâ€™Ã©tait pas lâ€™Ãªtre. Ce nâ€™Ã©tait pas la lumiÃ¨re.

Alors, doucement, avec une infinie tendresse, lâ€™Ãªtre sâ€™est approchÃ© du miroir. Il nâ€™a pas voulu le briser davantage. Non. Il a soufflÃ© dessus. Il a caressÃ© sa surface. Il a osÃ© regarder au-delÃ  des cassures. Et lÃ , il a vuâ€¦ une lumiÃ¨re intacte. Un Ã©clat vivant. Un regard doux. Le dÃ©but dâ€™un pardon.

---

## II. Le jardin des comparaisons

La jalousie pousse dans un jardin particulier. Un jardin oÃ¹ lâ€™on sÃ¨me des comparaisons. OÃ¹ chaque fleur regarde les autres et se demande : Â« Suis-je assez belle ? Suis-je aimÃ©e ? Suis-je unique ? Â» Et dans ce jardin, certaines plantes se fanent parce quâ€™elles oublient leur nature propre.

Mais un jour, une fleur dÃ©cida de cesser de se comparer. Elle se tourna vers le soleil, profondÃ©ment. Elle sâ€™Ã©tira dans sa singularitÃ©. Elle comprit quâ€™elle Ã©tait belle non pas parce quâ€™elle surpassait les autres, mais parce quâ€™elle Ã©tait elle-mÃªme. Unique. Vivante. IrrÃ©ductible.

Et alors, quelque chose changea dans le jardin. Les autres fleurs aussi se redressÃ¨rent. Chacune trouva sa place. Plus besoin de rivalitÃ©. Plus besoin dâ€™envie. Juste une cohabitation douce, harmonieuse, fertile.

---

## III. La forÃªt des blessures

Il y a dans chacun de nous une forÃªt ancienne. Une forÃªt pleine de souvenirs, de blessures anciennes, de douleurs non exprimÃ©es. La jalousie y trouve ses racines. Car souvent, elle naÃ®t dâ€™un manque : manque dâ€™amour, de reconnaissance, de sÃ©curitÃ©.

Dans cette forÃªt, une silhouette avance. Câ€™est toi. Tu portes une lanterne. Tu nâ€™as pas peur. Car tu sais quâ€™en Ã©clairant cette forÃªt, tu ne la dÃ©truis pas. Tu lâ€™honores. Tu lui donnes une nouvelle chance. Et chaque arbre que tu touches se transforme : le chÃªne de la trahison devient un arbre de sagesse, le saule du rejet se redresse avec fiertÃ©, le pin du doute retrouve ses aiguilles de clartÃ©.

Et dans cette forÃªt purifiÃ©e, tu peux construire une maison intÃ©rieure. Solide. Paisible. Libre.

---

## IV. Lâ€™Ã©lixir de confiance

La jalousie se nourrit de mÃ©fiance. De peur. De manque de sÃ©curitÃ© intÃ©rieure. Mais il existe en toi un Ã©lixir oubliÃ©. Un nectar ancien : la confiance. Pas la confiance aveugle. Mais celle qui naÃ®t dâ€™un enracinement profond, dâ€™un amour lucide pour soi-mÃªme.

Imagine que tu tiens entre tes mains une fiole. Dans cette fiole, un liquide dorÃ©, vibrant. Chaque goutte contient une phrase puissante :
âœ¨ Â« Je suis digne dâ€™amour. Â»
âœ¨ Â« Je mÃ©rite le respect. Â»
âœ¨ Â« Ce que jâ€™ai en moi est prÃ©cieux. Â»

Ã€ chaque fois que tu bois une goutte de cet Ã©lixir imaginaire, quelque chose en toi sâ€™apaise. Ton cÅ“ur se redresse. Tes pensÃ©es sâ€™Ã©clairent. Et tu peux regarder lâ€™autreâ€¦ non plus comme un rival, mais comme un Ãªtre libre, qui ne menace en rien ta propre valeur.

---

## V. Le thÃ©Ã¢tre intÃ©rieur

Dans ton esprit existe un thÃ©Ã¢tre. Et parfois, sur sa scÃ¨ne, des personnages se battent : la peur, le contrÃ´le, le manque, la colÃ¨re. Ils jouent des drames, des scÃ¨nes de soupÃ§on et de rivalitÃ©.

Mais dans la salle, il y a un spectateur plus grand. Câ€™est toi, dans ta pleine conscience. Tu observes cette piÃ¨ce. Et doucement, tu comprends que tu peux rÃ©Ã©crire le scÃ©nario. Tu peux faire monter sur scÃ¨ne un nouveau personnage : la sÃ©rÃ©nitÃ©.

Et quand la sÃ©rÃ©nitÃ© entre, les autres sâ€™apaisent. Le dÃ©cor change. La lumiÃ¨re devient chaude, ambrÃ©e. Lâ€™histoire devient plus belle. Tu ne joues plus une tragÃ©die. Tu composes une symphonie dâ€™acceptation.

---

## VI. Le pont de la transformation

La jalousie te fait croire quâ€™il faut possÃ©der, retenir, enfermer. Mais lâ€™amour vrai, lui, ne retient pas. Il fait confiance. Il laisse respirer. Il choisit Ã  chaque instant, sans contrainte.

Alors tu construis un pont. Un pont intÃ©rieur. Entre lâ€™attachement et la libertÃ©. Entre la peur et la confiance. Entre le manque et la plÃ©nitude.

Ce pont, tu le traverses Ã  ton rythme. Tu regardes en arriÃ¨re avec gratitude, mais tu choisis dâ€™avancer. Tu avances vers un amour mature. Un amour apaisÃ©. Un amour qui ne se nourrit plus de jalousie, mais de prÃ©sence consciente.

---

## VII. La guÃ©rison par le feu doux

Il y a en toi une flamme. Un feu doux. Ce feu, câ€™est ton intÃ©gritÃ©. Câ€™est ta lumiÃ¨re. Câ€™est ton authenticitÃ©. Il peut brÃ»ler les rÃ©sidus de jalousie, sans violence. Il transmute. Il Ã©claire.

Assieds-toi prÃ¨s de ce feu symbolique. Regarde-le danser. Donne-lui les pensÃ©es toxiques, les croyances erronÃ©es, les peurs infantiles. Il les transformera en chaleur. En clartÃ©. En force tranquille.

Et dans cette chaleur nouvelle, tu sens que tu es capable dâ€™aimer sans peur. De regarder lâ€™autre vivre, libre, et de rester stable. CentrÃ©. Ouvert.

---

## VIII. Le retour Ã  soi

Au bout de ce voyage, il y a un retour. Non pas Ã  lâ€™ancien toi, mais Ã  un soi plus vaste. Plus fort. Plus doux. Tu nâ€™es plus esclave de cette jalousie qui tâ€™enfermait. Tu lâ€™as rencontrÃ©e. Tu lâ€™as comprise. Tu lâ€™as transformÃ©e.

Et maintenant, tu peux te lever. Marcher. Respirer. Regarder avec luciditÃ© et sÃ©rÃ©nitÃ©. Tu sais que tu as une valeur unique, infinie, inaltÃ©rable.

Et chaque jour, tu peux revenir Ã  ce jardin, Ã  cette forÃªt, Ã  ce feu. Tu es libre. Tu es en paix. Tu es entier.

---

ğŸŒŸ **Conclusion : Un amour plus vaste**

La jalousie nâ€™Ã©tait quâ€™un appel. Un appel vers toi-mÃªme. Vers ton besoin dâ€™Ãªtre vu, reconnu, aimÃ©. Maintenant que tu lâ€™as entendu, tu peux rÃ©pondre Ã  cet appelâ€¦ autrement. Avec maturitÃ©, tendresse, grandeur.

Tu peux aimer sans peur. Tu peux tâ€™aimer pleinement. Tu peux regarder la vie comme une cohabitation fÃ©conde, et non comme une compÃ©tition stÃ©rile.

Et dans cette paix nouvelle, une joie douce sâ€™installe. Une force tranquille. Une lumiÃ¨re qui ne sâ€™Ã©teint plus.

---
`;

	function generatePrompt() {
		generatedPrompt = `Tu es un hypnothÃ©rapeute expert. RÃ©dige un script hypnotique personnalisÃ© ${formData.induction ? 'sans induction' : 'avec induction'} destinÃ© Ã  un patient Ã¢gÃ© de ${formData.age} ans, souffrant de ${formData.pathologie}, ayant dÃ©jÃ  suivi une thÃ©rapie de ce type: ${formData.therapiePrecedente}, et souhaitant rÃ©soudre son problÃ¨me qui est le suivant : ${formData.objectif}. Le ton doit Ãªtre ${formData.ton}, et la durÃ©e approximative est de ${formData.duree} min. Inclure des mÃ©taphores et des suggestions trÃ¨s adaptÃ©es.
		Voici un exemple de structure souhaitÃ©e (en Markdown) :

${exempleResponse}

Merci de respecter le style de l'exemple dans la gÃ©nÃ©ration du script. Merci de gÃ©nÃ©rer des retours Ã  la ligne et un texte bien structurÃ©, prÃªt pour une conversion en pdf ou word`;

		aiResponse = '';
		error = '';
	}

	async function sendToOpenAI() {
		if (!generatedPrompt) {
			error = "GÃ©nÃ¨re d'abord le prompt !";
			return;
		}
		loading = true;
		error = '';
		aiResponse = '';

		try {
			const res = await fetch('/api', {
				method: 'POST',
				headers: { 'Content-Type': 'application/json' },
				body: JSON.stringify({ prompt: generatedPrompt })
			});

			const data = await res.json();

			if (res.ok) {
				aiResponse = data.reply;
			} else {
				error = data.error || 'Erreur inconnue';
			}
		} catch (e) {
			error = e.message;
		} finally {
			loading = false;
		}
	}
</script>

<!-- HTML-->

<!-- <h2>CrÃ©ation de protocole d'hypnose</h2> -->

<main>
	<div class="container__form">
		<div class="wrapper__selections">
			<select bind:value={formData.age}>
				<option value="" disabled selected>Choisissez un Ã¢ge</option>
				{#each ages as age}
					<option value={age}>{age}</option>
				{/each}
			</select>
		</div>

		<!-- ============= -->

		<div class="wrapper__selections">
			<label for="profil">Profil :</label>
			<select id="profil" bind:value={formData.profil}>
				<option value="" disabled selected>Choisir le profil</option>
				<option value="anxieux">Anxieux</option>
				<option value="depressif">DÃ©pressif</option>
				<option value="stresse">StressÃ©</option>
				<option value="hyperactif">Hyperactif</option>
				<option value="hyperactif">phobique</option>
			</select>
		</div>

		<!-- ============= -->

		<div class="wrapper__selections">
			<label for="pathologie">Pathologie :</label>
			<select id="pathologie" bind:value={formData.pathologie}>
				<option value="" disabled selected>Choisir le type de pathologie</option>

				<option value="anxiete_generalisee">Trouble d'anxiÃ©tÃ© gÃ©nÃ©ralisÃ©e</option>
				<option value="trouble_bipolaire">Trouble bipolaire</option>
				<option value="troubles_alimentaires">Troubles alimentaires</option>
				<option value="trouble_panique">Trouble panique</option>
				<option value="troubles_obsessionnels_compulsifs">Troubles obsessionnels compulsifs (TOC)</option>
				<option value="tdah">Trouble du dÃ©ficit de l'attention avec hyperactivitÃ© (TDAH)</option>
				<option value="trouble_stress_post_traumatique">Trouble de stress post-traumatique (TSPT)</option>

				<option value="TraumatisÃ©">TraumatisÃ©</option>
				<option value="phobies">Phobie spÃ©cifique</option>
				<option value="depression_majeure">DÃ©pression majeure</option>

				<option value="addictions">Addiction tabac</option>
				<option value="addictions">Addiction alcool</option>
				<option value="addictions">Addiction drogue et mÃ©dicaments</option>

				<option value="En deuil">Deuil</option>
				<option value="Burnout">Burnout</option>
				<option value="Douleurs chroniques">Douleurs chroniques</option>
				<option value="DÃ©pression clinique">DÃ©pression clinique</option>
			</select>
		</div>

		<!-- ============= -->

		<div class="wrapper__selections">
			<label for="therapiePrecedente">ThÃ©rapie prÃ©cÃ©dente :</label>
			<select id="therapiePrecedente" bind:value={formData.therapiePrecedente}>
				<option value="" disabled selected>Choisir la thÃ©rapie prÃ©cÃ©dente</option>
				<option value="Aucune thÃ©rapie antÃ©rieure">Aucune thÃ©rapie antÃ©rieure</option>
				<option value="ThÃ©rapie cognitive-comportementale (TCC)">ThÃ©rapie cognitive-comportementale (TCC)</option>
				<option value="ThÃ©rapie analytique / psychanalyse">ThÃ©rapie analytique / psychanalyse</option>
				<option value="EMDR (dÃ©sensibilisation par les mouvements oculaires)">EMDR (dÃ©sensibilisation par les mouvements oculaires)</option>
				<option value="ThÃ©rapie systÃ©mique">ThÃ©rapie systÃ©mique</option>
				<option value="Sophrologie">Sophrologie</option>
				<option value="MÃ©ditation / Pleine conscience">MÃ©ditation / Pleine conscience</option>
				<option value="Soins Ã©nergÃ©tiques / Reiki">Soins Ã©nergÃ©tiques / Reiki</option>
				<option value="Accompagnement par un coach">Accompagnement par un coach</option>
				<option value="ThÃ©rapie brÃ¨ve stratÃ©gique">ThÃ©rapie brÃ¨ve stratÃ©gique</option>
				<option value="ThÃ©rapie ACT (Acceptance and Commitment Therapy)">ThÃ©rapie ACT (Acceptance and Commitment Therapy)</option>
				<option value="Autre thÃ©rapie non listÃ©e">Autre thÃ©rapie non listÃ©e</option>
			</select>
		</div>

		<!-- ============= -->

		<div class="wrapper__selections">
			<label for="methodeHypnose">MÃ©thode d'hypnose :</label>
			<select id="methodeHypnose" bind:value={formData.methodeHypnose}>
				<option value="" disabled selected>Choisir la mÃ©thode</option>
				<option value="Gestalt-thÃ©rapie">Gestalt-thÃ©rapie</option>
				<option value="Hypnose ericksonienne">Hypnose ericksonienne</option>
				<option value="Analyse transactionnelle">Analyse transactionnelle</option>
				<option value="PNL">PNL</option>
				<option value="TPI">TPI</option>
				<option value="Autre">Autre</option>
			</select>
		</div>

		<!-- ============= -->

		<div class="wrapper__selections">
			<select name="duration" id="duration" bind:value={formData.duree}>
				<option value="" disabled selected>Choisir la durÃ©e</option>
				<option value="20">20 minutes</option>
				<option value="40">40 minutes</option>
				<option value="60">1 heure</option>
			</select>
		</div>

		<!-- ============= -->

		<div class="wrapper__selections">
			<label for="duration">Ton adaptÃ©</label>
			<select name="duration" id="duration" bind:value={formData.ton}>
				<option value="" disabled selected>Choisir le ton</option>
				<option value="Doux">Doux</option>
				<option value="Apaisant">Apaisant</option>
				<option value="Profond">Profond</option>
				<option value="Profond">Rassurant</option>
				<option value="Profond">Intense</option>
			</select>
		</div>

		<!-- ============= -->

		<div class="wrapper__selections">
			<label>
				<input type="radio" name="induction" value="Avec induction" bind:group={formData.induction} />
				Avec induction
			</label>
			<label>
				<input type="radio" name="induction" value="Sans induction" bind:group={formData.induction} />
				Sans induction
			</label>
		</div>

		<!-- ============= -->

		<div class="wrapper__selections">
			<textarea name="Objectif" bind:value={formData.objectif} placeholder="Quelle est la raison du mal Ãªtre ?"></textarea>
		</div>

		<!-- ============= -->
		<button on:click={generatePrompt}>GÃ©nÃ©rer le protocole</button>
		<button on:click={sendToOpenAI} disabled={loading}>{loading ? 'En cours...' : 'Envoyer Ã  OpenAI'}</button>

		{#if generatedPrompt}
			<pre>Prompt gÃ©nÃ©rÃ© :
{generatedPrompt}</pre>
		{/if}

		{#if error}
			<p style="color: red;">{error}</p>
		{/if}

		{#if aiResponse}
			<p>
				{aiResponse}
			</p>
		{/if}
	</div>
</main>

<style>
	main {
		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: center;
		height: 100vh;
		background-color: #121212;
		color: white;
	}
	.container__form {
		display: grid;
		grid-template-columns: repeat(3, 1fr);
		grid-template-rows: 50px 50px 50px 50px;
		gap: 10px;
		height: 100%;
		padding: 20px;
	}
	.wrapper__selections {
		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: center;
		width: 100%;
		gap: 10px;
	}
	.container__form label {
		font-weight: bold;
		display: none;
	}
	.container__form input,
	.container__form select {
		padding: 5px;
		border: none;
		border-radius: 10px;
		padding: 10px;
		box-shadow: 0px 10px 10px rgba(0, 0, 0, 0.1);
		width: 300px;
		background-color: #303030;
		color: white;
	}
	.container__form button {
		padding: 0px;
		background-color: #007bff;
		color: white;
		border: none;
		border-radius: 5px;
		cursor: pointer;
	}
	.container__form button:disabled {
		background-color: #ccc;
		cursor: not-allowed;
	}
	.container__form p {
		background-color: #f8f9fa;
		padding: 10px;
		border-radius: 5px;
		line-height: 35px;
	}
	.container__form p {
		color: rgb(55, 26, 200);
		font-family: 'Tahoma' sans-serif;
		text-align: center;
		width: 50%;
		margin: 0 auto;
	}
	.container__form label {
		font-family: 'Tahoma' sans-serif;
	}
	.container__form textarea {
		width: 90%;
		height: 100px;
	}

	@media screen and (max-width: 768px) {
		.container__form {
			grid-template-columns: 1fr;
		}
		.container__form button {
			width: 100%;
		}
		.container__form textarea {
			width: 100%;
		}
	}
</style>
